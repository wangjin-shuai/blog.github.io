<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>asyncTask多线程学习 | 菜虫虫</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="asyncTask多线程学习">
<meta name="keywords" content="android">
<meta property="og:type" content="article">
<meta property="og:title" content="asyncTask多线程学习">
<meta property="og:url" content="http://yoursite.com/2019/07/15/asyncTask多线程学习/index.html">
<meta property="og:site_name" content="菜虫虫">
<meta property="og:description" content="asyncTask多线程学习">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-08-25T11:44:37.420Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="asyncTask多线程学习">
<meta name="twitter:description" content="asyncTask多线程学习">
  
    <link rel="alternate" href="/atom.xml" title="菜虫虫" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/touxiang.webp">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
  <script>
  let antiquityStorage = window.sessionStorage.getItem('antiquitySessionStorage');
  if (antiquityStorage == '' || antiquityStorage == null) {
    var antiquityLoader = '<div id="loaderbox"><div class="loader"><div class="load-roll"><div class="load-top"></div><div class="load-right"></div><div class="load-bottom"></div></div></div></div>';
    document.write(antiquityLoader);
    document.body.style.overflow = 'hidden'
  }
  </script>
</head>
</html>
<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" style="background-image: url(/images/bg_1.webp)" title="背景图片来自网络">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main"><article id="post-asyncTask多线程学习" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      asyncTask多线程学习
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/07/15/asyncTask多线程学习/" class="article-date">
  <time datetime="2019-07-15T07:22:18.000Z" itemprop="datePublished">2019-07-15</time>
</a>
    
    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>

  </div>
  
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h1 id="asyncTask多线程学习"><a href="#asyncTask多线程学习" class="headerlink" title="asyncTask多线程学习"></a>asyncTask多线程学习</h1><a id="more"></a>

<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><pre><code>·一个Android已封装的好的轻量级异步类
·属于抽象类，即使用时需实现子类

public abstract class AsyncTask&lt;Params, Progress, Result&gt; { 
 ... 
 }</code></pre><hr>
<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>1、 实现多线程<br><br>2、异步通信、消息传递，实现龚总线程与主线程（UI线程）之间的通信<br>即：将工作线程的执行结果传递给主线程，从而在主线程中执行相关的UI操作<br>从而保证线程安全</p>
<hr>
<h1 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h1><p>·方便实现异步通信<br>不需要使用“任务线程（如继承Thread类）+Handler”的复杂组合<br><br>·节省资源<br><br>采用线程池的缓存线程+复用线程，避免了频繁创建与销毁线程多带来的系统资源的开销</p>
<hr>
<h1 id="类定义"><a href="#类定义" class="headerlink" title="类定义"></a>类定义</h1><p>AsyncTask类属于抽象类，即使用时需要实现子类</p>
<pre><code>public abstract class AsyncTask&lt;Params,Progress,Result&gt;{
...
}
//类中参数为3中泛型类型
//整体作用：控制AsyncTash子类执行线程任务时各个阶段的返回类型
//具体说明
/*
Params：开始异步任务执行时传入的参数类型，对应excute（）中传递的参数
Progress：异步任务执行过程中，返回下载进入值的类型
Result：异步任务执行完成后，返回的结果类型，与doInBackground()的返回值保持一致

注：
    使用时并不是所有类型都被使用
    若无被使用，可用java.lang.Void类型代替
    若有不同业务，需额外再一个AsyncTask的子类
*/</code></pre><hr>
<h1 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h1><p>AsyncTask的使用步骤有3个：</p>
<p>1、创建 AsyncTask 子类 &amp; 根据需求实现核心方法</p>
<p>2、创建 AsyncTask子类的实例对象（即 任务实例）</p>
<p>3、手动调用execute(（）从而执行异步线程任务</p>
<pre><code>/**
  * 步骤1：创建AsyncTask子类
  * 注： 
  *   a. 继承AsyncTask类
  *   b. 为3个泛型参数指定类型；若不使用，可用java.lang.Void类型代替
  *   c. 根据需求，在AsyncTask子类内实现核心方法
  */

  private class MyTask extends AsyncTask&lt;Params, Progress, Result&gt; {

    ....

  // 方法1：onPreExecute（）
  // 作用：执行 线程任务前的操作
  // 注：根据需求复写
  @Override
  protected void onPreExecute() {
       ...
    }

  // 方法2：doInBackground（）
  // 作用：接收输入参数、执行任务中的耗时操作、返回 线程任务执行的结果
  // 注：必须复写，从而自定义线程任务
  @Override
  protected String doInBackground(String... params) {

        ...// 自定义的线程任务

        // 可调用publishProgress（）显示进度, 之后将执行onProgressUpdate（）
         publishProgress(count);

     }

  // 方法3：onProgressUpdate（）
  // 作用：在主线程 显示线程任务执行的进度
  // 注：根据需求复写
  @Override
  protected void onProgressUpdate(Integer... progresses) {
        ...

    }

  // 方法4：onPostExecute（）
  // 作用：接收线程任务执行结果、将执行结果显示到UI组件
  // 注：必须复写，从而自定义UI操作
  @Override
  protected void onPostExecute(String result) {

     ...// UI操作

    }

  // 方法5：onCancelled()
  // 作用：将异步任务设置为：取消状态
  @Override
    protected void onCancelled() {
    ...
    }
  }

/**
  * 步骤2：创建AsyncTask子类的实例对象（即 任务实例）
  * 注：AsyncTask子类的实例必须在UI线程中创建
  */
  MyTask mTask = new MyTask();

/**
  * 步骤3：手动调用execute(Params... params) 从而执行异步线程任务
  * 注：
  *    a. 必须在UI线程中调用
  *    b. 同一个AsyncTask实例对象只能执行1次，若执行第2次将会抛出异常
  *    c. 执行任务中，系统会自动调用AsyncTask的一系列方法：onPreExecute() 、doInBackground()、onProgressUpdate() 、onPostExecute() 
  *    d. 不能手动调用上述方法
  */
  mTask.execute()；</code></pre><h1 id="关于-生命周期"><a href="#关于-生命周期" class="headerlink" title="关于 生命周期"></a>关于 生命周期</h1><p>结论<br>AsyncTask不与任何组件绑定生命周期<br>使用建议<br>在Activity 或 Fragment中使用 AsyncTask时，最好在Activity 或 Fragment的onDestory（）调用 cancel(boolean)；</p>
<h2 id="关于-内存泄漏"><a href="#关于-内存泄漏" class="headerlink" title="关于 内存泄漏"></a>关于 内存泄漏</h2><p>结论<br><br>若AsyncTask被声明为Activity的非静态内部类，当Activity需销毁时，会因AsyncTask保留对Activity的引用 而导致Activity无法被回收，最终引起内存泄露<br><br>使用建议<br><br>AsyncTask应被声明为Activity的静态内部类</p>
<h2 id="线程任务执行结果-丢失"><a href="#线程任务执行结果-丢失" class="headerlink" title="线程任务执行结果 丢失"></a>线程任务执行结果 丢失</h2><p><br>结论<br>当Activity重新创建时（屏幕旋转 / Activity被意外销毁时后恢复），之前运行的AsyncTask（非静态的内部类）持有的之前Activity引用已无效，故复写的onPostExecute()将不生效，即无法更新UI操作<br><br>使用建议<br><br>在Activity恢复时的对应方法 重启 任务线程</p>

      
    </div>
    
      <footer class="article-footer">
        完
      </footer>
    
  </div>
  
    
<nav id="article-nav">
  <div class="article-nav-block">
    
      <a href="/2019/07/16/Intent/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"></strong>
        <div class="article-nav-title">
          
            Intent
          
        </div>
      </a>
    
  </div>
  <div class="article-nav-block">
    
      <a href="/2019/07/13/android通知栏/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">Android通知栏操作</div>
        <strong class="article-nav-caption"></strong>
      </a>
    
  </div>
</nav>

    
<div id="gitmentContainer"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  owner: '',
  repo: '',
  oauth: {
    client_id: '899a8cf35eb9aa138feb',
    client_secret: '7562de49365f594817c3f8055a52e2f807bb7c10',
  },
})
gitment.render('gitmentContainer')
</script>

  
  
</article>
</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/touxiang.webp" title="菜虫虫"></img>
    <h3 class="avatar-name">
      
        菜虫虫
      
    </h3>
    <p class="avatar-slogan">
      一只努力码代码的菜虫虫。
    </p>
  </div>
</div>


  
    

  
    
  <div class="widget-box">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/study/">study</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-box">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/study/" style="font-size: 10px;">study</a>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/01/代码整洁知道-01/">代码整洁之道</a>
          </li>
        
          <li>
            <a href="/2019/08/31/postgresql-01/">postgresql_01</a>
          </li>
        
          <li>
            <a href="/2019/08/17/装饰者模式/">装饰者模式</a>
          </li>
        
          <li>
            <a href="/2019/07/31/android启动页/">android启动页</a>
          </li>
        
          <li>
            <a href="/2019/07/31/activity四种启动模式/">activity四种启动模式</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://wangjin-shuai.github.io/" title target='_blank'
        >菜虫虫</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2019 菜虫虫 &nbsp;&nbsp;
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">菜虫虫告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>